@model LifeOne.Models.HomeManagement.HEntity.MForgotPassword

@{
    ViewBag.Title = "ForgotPassword";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="site-main">
    <div class="ttm-row loginId padding-section">
        <div class="container">
            <div class="loginIdWrap">

                <h2>LifeOne ID</h2>
                <h3>Forgot Password</h3>

                <div class="form-group position-relative">

                    <div class="form-group" id="dvUserId">
                        @Html.TextBoxFor(Model => Model.UserId, new { @class = "idinput", @placeholder = "Enter Your Login Id" })
                        <span class="small">@Html.ValidationMessageFor(Model => Model.UserId, "", new { @class = "text-danger" })</span>
                    </div>
                    <div class="form-group" id="dvOTP">

                        @Html.TextBoxFor(Model => Model.OTP, new { @class = "idinput", @placeholder = "Enter OTP" })

                    </div>
                    <div class="form-group" id="dvNewPassword">

                        @Html.TextBoxFor(Model => Model.NewPassword, new { @type = "password", @class = "idinput", @placeholder = "New Password" })

                    </div>
                    <div class="form-group" id="dvConfPassword">
                        @Html.TextBoxFor(Model => Model.ConfirmPassword, new { @type = "password", @class = "idinput", @placeholder = "Confirm Password" })
                        @Html.HiddenFor(Model => Model.Pk_MemId)
                    </div>

                    <div class="form-group">

                        @*<button class="loginbtn-icon" id="btnSendOTP" onclick="getOTP()" type="submit"> <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></button>*@
                        <input type="submit" name="sign-in" class="ttm-btn ttm-btn-size-md ttm-btn-bgcolor-skincolor btn-block" id="btnSendOTP" onclick="getOTP()" value="SEND OTP" />
                        <div class="text-right mb-1 text-white"><a id="btnReSendOTP" href="javascript:void(0)" onclick="getOTP()" style="color:white">Resend OTP</a></div>
                        <button class="btn btn-success btn-block text-uppercase waves-effect waves-light" id="btnVerifyOTP" type="button" onclick="matchOTP()">Verify OTP</button>

                        <button class="btn btn-warning btn-block text-uppercase waves-effect waves-light" id="btnChangePassword" type="button" onclick="return changePassword()">Change Password</button>
                        <p style="color:white" id="pMessage"></p>
                    </div>
                </div>
                <p class="forogt"><a href="/Home/MemberLogin"> Goto Login Page</a></p>

            </div>
        </div>
    </div>
    <section class="ttm-row history-section bg-img3 ttm-bgcolor-grey ttm-bg ttm-bgimage-yes clearfix">
        <div class="container">
            <div class="row">
                <!-- row -->
                <div class="col-lg-8 offset-lg-2">
                    <!-- section title -->
                    <div class="section-title with-desc text-center clearfix">
                        <div class="title-header">
                            <h2 class="title">Our Sevices <span></span></h2>
                        </div>
                    </div>
                    <!-- section title end -->

                </div>
            </div>
            <!-- row end -->
            <!-- row -->
            <div class="row">
                <div class="icons-slide owl-carousel">
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/refer-icon.png" alt="">
                            <h5>Refer & Earn</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/offer-icon.png" alt="">
                            <h5>Offers</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/reward-icon.png" alt="">
                            <h5>Rewards</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/prepaid-mobile-recharge.png" alt="">
                            <h5>Prepaid Mobile Recharge</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/postpaid-mobile-recharge.png" alt="">
                            <h5>Post-Paid Mobile Bill Payment</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/dth-icon.png" alt="">
                            <h5>DTH Recharge</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/flight-booking-icon.png" alt="">
                            <h5>Flight Ticket Booking</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/bus-booking-icon.png" alt="">
                            <h5>Bus Ticket Booking</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/hotel-booking-icon.png" alt="">
                            <h5>Hotel Booking</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/bus-booking-icon.png" alt="">
                            <h5>Online Shopping</h5>
                        </a>
                    </div>
                    <div class="featured-icon-box text-center">
                        <a href="#">
                            <img class="img-fluid lazyload" src="~/Content/assests/images/icon/affiliate-icon.png" alt="">
                            <h5>Affiliate Shopping</h5>
                        </a>
                    </div>

                </div>
            </div>
            <!-- row end-->
        </div>
    </section>
</div>

<script>
    $(document).ready(function () {
        debugger;
        $("#dvOTP").hide();
        $("#btnVerifyOTP").hide();
        $("#dvNewPassword").hide();
        $("#dvConfPassword").hide();
        $("#btnReSendOTP").hide();
        $("#btnChangePassword").hide();
        setTimeout(function () {
            $('.msgdiv').fadeOut(6000);
        }, 6000);
    });

    function getOTP() {
        debugger

        if ($("#UserId").val() == "") {
            $("#pMessage").html("Please Enter UserId Or MobileNo.");
            return false;
        }
        debugger;
        $.ajax({
            url: '/Home/Franchise_GetOTP',
            type: "GET",
            dataType: "JSON",
            data: { UserId: $("#UserId").val() },
            success: function (data) {
                debugger;
                if (data.Flag == "1") {
                    $("#pMessage").html("OTP Sent to your Mobile No. and is valid for 5 minutes");
                    $("#Pk_MemId").val(data.Pk_MemId);
                    $("#dvOTP").show();
                    $("#btnReSendOTP").show();
                    $("#btnSendOTP").hide();
                    $("#dvMobileNo").hide();
                    $("#dvUserId").hide();
                    $("#btnVerifyOTP").show();
                } else {
                    alert(data.Msg);
                }
            }
        });
    }

    function matchOTP() {
        var UserId = $("#UserId").val();
        var otp = $("#OTP").val();
        $.ajax({
            url: '/Home/Franchise_MatchOTP',
            type: "GET",
            dataType: "JSON",
            data: { UserId: UserId, OTP: otp },
            success: function (data) {
                debugger;
                if (data.Flag == "1") {
                    $("#dvOTP").hide();
                    $("#dvNewPassword").show();
                    $("#dvConfPassword").show();
                    $("#btnReSendOTP").hide();
                    $("#btnSendOTP").hide();
                    $("#btnVerifyOTP").hide();
                    $("#btnChangePassword").show();
                    $("#pMessage").html("");
                } else {
                    $("#pMessage").html(data.Msg);
                }
            }
        });
    }

    function changePassword() {
        if ($("#NewPassword").val() == "") {
            alert("Please Enter New Password");
            return;
        }
        if ($("#ConfirmPassword").val() == "") {
            alert("Please Enter Confirm Password");
            return;
        }
        if ($("#NewPassword").val() != $("#ConfirmPassword").val()) {
            alert("Password do not Match");
            return;
        }
        $.ajax({
            url: '/Home/Franchise_ForgetPassword',
            type: "GET",
            dataType: "JSON",
            data: { UserId: $("#UserId").val(), NewPassword: $("#NewPassword").val() },
            success: function (data) {
                debugger;
                if (data.Flag == "1") {
                    alert("Password Changed Successfully");
                    window.location.href = "/Home/FranchiseLogin";
                } else {
                    alert(data.Msg);
                }
            }
        });
    }
</script>

