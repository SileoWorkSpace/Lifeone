@model LifeOne.Models.AdminManagement.AEntity.MembersToMakePaymentModel
@{
    ViewBag.Title = "PayoutClosing";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
    <script src="~/Content/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<style>
    .pull-right {
        float: right;
    }
</style>
<div class="row page-titles">
    <div class="ptitle">
        <h3 class="text-themecolor">Pay-out Closing</h3>
        <ol class="breadcrumb"><li class="breadcrumb-item"><a href="#">Pay-out</a></li><li class="active breadcrumb-item" aria-current="page">Pay-out Closing</li></ol>
    </div>


</div>
<div class="row">
    <div class="col-lg-12 stretch-card">
        <div class="card">
            <div class="card-header">
                

            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12 col-md-7">
                        <div class="row">
                            <div class="col-12 col-md-4">
                                <div class="form-group">
                                    <h3>Closing Date :</h3>
                                </div>
                            </div>
                            <div class="col-12 col-md-4">
                                <div class="form-group">
                                    @Html.TextBoxFor(m => m.ClosingDate, new { @class = "form-control dtPicker", @type = "date" })
                                </div>
                            </div>
                            <div class="col-12 col-md-12">
                                <div class="form-group">
                                    <input type="button" name="submit" id="btnsubmit" value="Close Payout" class="btn btn-success  waves-effect waves-light float-right" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive" id="testTable">
                    <table class="table color-table inverse-table table-bordered">
                        <thead>
                            <tr>
                                <th><input type="checkbox" checked="checked" id="checkAll" /> All</th>
                                <th>S. No.</th>
                                <th>LoginId</th>
                                <th>Name</th>
                                <th>Self Income</th>
                                <th>Team Income</th>
                                <th>AirOrbit Income</th>
                                <th>WaterOrbit Income</th>
                                <th>SpaceOrbit Income</th>
                                <th>Royality Income</th>
                                <th>OrbitRoyality Income</th>
                                <th>Leadership Income</th>
                                <th>Club Bonus</th>
                                <th>Gross Amount</th>
                                <th>TDS Amount</th>
                                <th>Processing Fee</th>
                                <th>Net Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                decimal TotalSelfIncome = 0;
                                decimal TotalTeamIncome = 0;
                                decimal TotalAirOrbitIncome = 0;
                                decimal TotalWaterOrbitIncome = 0;
                                decimal TotalSpaceOrbitIncome = 0;
                                decimal TotalSmartRoyaltyIncome = 0;
                                decimal TotalSmartOrbitRoyaltyIncome = 0;
                                decimal TotalSmartLeadershipIncome = 0;
                                decimal TotalGlobalAchieverClubBonus = 0;
                                decimal TotalGrossAmount = 0;
                                decimal TotalTDSAmount = 0;
                                decimal TotalProcessingFee = 0;
                                decimal TotalNetAmount = 0;
                                if (Model.PayoutMembers != null)
                                {
                                    int SNO = 0;
                                    foreach (var item in Model.PayoutMembers)
                                    {
                                                        <tr>
                                                            <td><input type="checkbox" checked="checked" id="@item.Fk_MemId" /></td>
                                                            <td>@(SNO = SNO + 1)</td>
                                                            <td>
                                                                @item.LoginId
                                                            </td>
                                                            <td>
                                                                @item.Name
                                                            </td>
                                                            <td>
                                                                @item.SelfIncome
                                                            </td>
                                                            <td>
                                                                @item.TeamIncome
                                                            </td>
                                                            <td>
                                                                @item.AirOrbitIncome
                                                            </td>
                                                            <td>
                                                                @item.WaterOrbitIncome
                                                            </td>
                                                            <td>
                                                                @item.SpaceOrbitIncome
                                                            </td>
                                                            <td>
                                                                @item.RoyaltyIncome
                                                            </td>
                                                            <td>
                                                                @item.OrbitRoyaltyIncome
                                                            </td>
                                                            <td>
                                                                @item.LeadershipIncome
                                                            </td>
                                                            <td>
                                                                @item.ClubBonus
                                                            </td>
                                                            <td>
                                                                @item.GrossAmount
                                                            </td>
                                                            <td>
                                                                @item.TDSAmount
                                                            </td>
                                                            <td>
                                                                @item.ProcessingFee
                                                            </td>
                                                            <td>
                                                                @item.NetAmount
                                                            </td>
                                                        </tr>
                                        TotalSelfIncome = TotalSelfIncome + Convert.ToDecimal(item.SelfIncome);
                                        TotalTeamIncome = TotalTeamIncome + Convert.ToDecimal(item.TeamIncome);
                                        TotalAirOrbitIncome = TotalAirOrbitIncome + Convert.ToDecimal(item.AirOrbitIncome);
                                        TotalWaterOrbitIncome = TotalWaterOrbitIncome + Convert.ToDecimal(item.WaterOrbitIncome);
                                        TotalSpaceOrbitIncome = TotalSpaceOrbitIncome + Convert.ToDecimal(item.AirOrbitIncome);
                                        TotalSmartRoyaltyIncome = TotalSmartRoyaltyIncome + Convert.ToDecimal(item.RoyaltyIncome);
                                        TotalSmartOrbitRoyaltyIncome = TotalSmartOrbitRoyaltyIncome + Convert.ToDecimal(item.OrbitRoyaltyIncome);
                                        TotalSmartLeadershipIncome = TotalSmartLeadershipIncome + Convert.ToDecimal(item.LeadershipIncome);
                                        TotalGlobalAchieverClubBonus = TotalGlobalAchieverClubBonus + Convert.ToDecimal(item.ClubBonus);
                                        TotalGrossAmount = TotalGrossAmount + Convert.ToDecimal(item.GrossAmount);
                                        TotalTDSAmount = TotalTDSAmount + Convert.ToDecimal(item.TDSAmount);
                                        TotalProcessingFee = TotalProcessingFee + Convert.ToDecimal(item.ProcessingFee);
                                        TotalNetAmount = TotalNetAmount + Convert.ToDecimal(item.NetAmount);
                                    }
                                }
                            }

                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4" style="text-align:center"><b>Total</b></td>
                                <td><b>@TotalSelfIncome</b></td>
                                <td><b>@TotalTeamIncome</b></td>
                                <td><b>@TotalAirOrbitIncome</b></td>
                                <td><b>@TotalWaterOrbitIncome</b></td>
                                <td><b>@TotalSpaceOrbitIncome</b></td>
                                <td><b>@TotalSmartRoyaltyIncome</b></td>
                                <td><b>@TotalSmartOrbitRoyaltyIncome</b></td>
                                <td><b>@TotalSmartLeadershipIncome</b></td>
                                <td><b>@TotalGlobalAchieverClubBonus</b></td>
                                <td><b>@TotalGrossAmount</b></td>
                                <td><b>@TotalTDSAmount</b></td>
                                <td><b>@TotalProcessingFee</b></td>
                                <td><b>@TotalNetAmount</b></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('.dtPicker').datepicker({
            format: 'DD/MM/YYYY',
        });
    });

    $('#checkAll').change(function(){
        if($(this).prop('checked')){
            $('tbody tr td input[type="checkbox"]').each(function(){
                $(this).prop('checked', true);
            });
        }else{
            $('tbody tr td input[type="checkbox"]').each(function(){
                $(this).prop('checked', false);
            });
        }
    });

    $('#btnsubmit').click(function () {
        debugger;
        this.disabled = true;
        if ($('#ClosingDate').val() == '') {
            alert("Please Select Closing Date");
            this.disabled = false;
            return;
        }
        if ($('#testTable tbody tr').length <= 0) {
            alert("There is No Record for Payout Closing");
            this.disabled = false;
            return;
        }
        if ($("#testTable tbody input:checkbox:checked").length <= 0) {
            alert("Please check any Record");
            this.disabled = false;
            return;
        }
        var counter = 0;
        $('#testTable').find('tbody tr').each(function () {
            debugger;
            var row = $(this);
            if (row.find('input[type="checkbox"]').is(':checked')) {
                var chk = row.find('input[type="checkbox"]')
                var chkid = chk.attr('id');
                var closingdate = $('#ClosingDate').val();
                 $.ajax({
                    url: '/Admin/PayoutClosing/MakePayments',
                    type: "Post",
                    dataType: "JSON",
                    data: { Fk_MemId: chkid, ClosingDate: closingdate },
                     success: function (data) {
                        if (data.Code == "0") {
                            alert(data.Remark);
                            this.disabled = false;
                            return;
                         }
                         if (data.Code == "1") {
                             counter++;
                         }
                    },
                    error: function (data) {
                        alert("server side error");
                        this.disabled = false;
                        return;
                    }
                })
            }

        });
        if (counter > 0) {
            alert("Payout Closed Successfully!");
            location.reload();
        } else {
           // alert("Problem to Close Payout");
            this.disabled = false;
        }
    });
</script>

